
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Good Morning M5</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Lexend Deca', 'sans-serif'],
              handwriting: ['Schoolbell', 'cursive'],
            },
            colors: {
              primary: '#007bff',
              accentGreen: '#28a745',
              accentYellow: '#ffc107',
              accentRed: '#dc3545',
            },
            keyframes: {
              'fade-in': {
                '0%': { opacity: '0' },
                '100%': { opacity: '1' },
              },
              'slide-up': {
                '0%': { transform: 'translateY(20px)', opacity: '0' },
                '100%': { transform: 'translateY(0)', opacity: '1' },
              },
              'pop-in': {
                '0%': { transform: 'scale(0.8)', opacity: '0' },
                '100%': { transform: 'scale(1)', opacity: '1' },
              }
            },
            animation: {
              'fade-in': 'fade-in 0.5s ease-out',
              'slide-up': 'slide-up 0.6s ease-out',
              'pop-in': 'pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
            }
          }
        }
      }
    </script>

    <!-- 2. Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@300;400;500;600&family=Schoolbell&display=swap" rel="stylesheet">

    <!-- 3. React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- 4. Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      body {
        transition: background-color 0.3s, color 0.3s;
      }
      /* Hide scrollbar for cleaner dashboard look */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent; 
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1; 
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8; 
      }

      /* ---- Place Value Grid System ---- */
      :root { --square-size: 20px; }
      
      .grid-container { 
          display: grid; 
          background-color: #ffffff; 
          border: 1px solid #cbd5e1; 
          transition: background-color 0.2s ease, transform 0.1s ease, border-color 0.2s ease; 
      }
      
      .grid-1x10 { 
          grid-template-columns: var(--square-size); 
          grid-template-rows: repeat(10, var(--square-size)); 
      }
      
      .square { 
          width: var(--square-size); 
          height: var(--square-size); 
          box-sizing: border-box; 
          border: 1px solid rgba(0,0,0,0.2); 
          background-color: #ffffff;
      }

      /* Interactive States */
      .grid-container.blue { 
          background-color: #3498db; 
          transform: scale(1.05); 
          border-color: #2980b9; 
      }

      .grid-container.blue .square {
          background-color: #3498db;
          border-color: #2980b9;
      }
      
      .square.green { 
          background-color: #2ecc71; 
          transform: scale(1.2); 
          border-color: #27ae60; 
          z-index: 10;
      }

      /* High Contrast Overrides */
      .hc-mode .grid-container { background-color: #1a1a1a; border-color: #fff; }
      .hc-mode .square { background-color: #1a1a1a; border-color: #fff; }
      
      .hc-mode .grid-container.blue { background-color: #3b82f6; border-color: #fff; }
      .hc-mode .grid-container.blue .square { background-color: #3b82f6; border-color: #fff; }
      
      .hc-mode .square.green { background-color: #22c55e; border-color: #fff; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- MAIN APPLICATION SCRIPT -->
    <script type="text/babel" data-type="module">
        /**
         * SETUP FOR BROWSER ENVIRONMENT
         * We shim process.env so we can use the standard configuration.
         */
        window.process = {
            env: {
                // -----------------------------------------------------------
                // ELEVEN LABS API KEY
                // -----------------------------------------------------------
                ELEVEN_LABS_API_KEY: 'sk_ed34d55944955291e4c085277560d981fd8fb59cdfa2b3a0' 
            }
        };

        /*********************************************************
         * CONSTANTS & DATA
         *********************************************************/
        const CLASS_LIST = [
            "Aisha", "Ben", "Chloe", "David", "Emma", 
            "Finn", "Grace", "Harry", "Isla", "Jack",
            "Liam", "Mia", "Noah", "Olivia", "Zoe"
        ];

        const TIMETABLES = {
            1: [ // Monday
                { time: '9:00', activity: 'Morning Circle', icon: '‚≠ï' },
                { time: '9:30', activity: 'Literacy Block', icon: 'üìñ' },
                { time: '11:00', activity: 'Recess', icon: 'üçé' },
                { time: '11:30', activity: 'Numeracy', icon: 'üî¢' },
                { time: '1:00', activity: 'Lunch', icon: 'ü•™' },
                { time: '2:00', activity: 'Science', icon: 'üß™' },
            ],
            2: [ // Tuesday
                { time: '9:00', activity: 'Morning Circle', icon: '‚≠ï' },
                { time: '9:30', activity: 'Numeracy', icon: 'üî¢' },
                { time: '11:00', activity: 'Recess', icon: 'üçé' },
                { time: '11:30', activity: 'Literacy Block', icon: 'üìñ' },
                { time: '1:00', activity: 'Lunch', icon: 'ü•™' },
                { time: '2:00', activity: 'Art', icon: 'üé®' },
            ],
            3: [ // Wednesday
                { time: '9:00', activity: 'Morning Circle', icon: '‚≠ï' },
                { time: '9:30', activity: 'Literacy Block', icon: 'üìñ' },
                { time: '11:00', activity: 'Recess', icon: 'üçé' },
                { time: '11:30', activity: 'Numeracy', icon: 'üî¢' },
                { time: '1:00', activity: 'Lunch', icon: 'ü•™' },
                { time: '2:00', activity: 'P.E.', icon: '‚öΩ' },
            ],
            4: [ // Thursday
                { time: '9:00', activity: 'Morning Circle', icon: '‚≠ï' },
                { time: '9:30', activity: 'Numeracy', icon: 'üî¢' },
                { time: '11:00', activity: 'Recess', icon: 'üçé' },
                { time: '11:30', activity: 'Literacy Block', icon: 'üìñ' },
                { time: '1:00', activity: 'Lunch', icon: 'ü•™' },
                { time: '2:00', activity: 'Music', icon: 'üéµ' },
            ],
            5: [ // Friday
                { time: '9:00', activity: 'Morning Circle', icon: '‚≠ï' },
                { time: '9:30', activity: 'Inquiry Project', icon: '‚ùì' },
                { time: '11:00', activity: 'Recess', icon: 'üçé' },
                { time: '11:30', activity: 'Free Choice', icon: 'üé≤' },
                { time: '1:00', activity: 'Lunch', icon: 'ü•™' },
                { time: '2:00', activity: 'Assembly', icon: 'üì¢' },
            ],
        };

        const WEEKDAYS = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        const MONTHS = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

        // Curated list of primary school appropriate words
        const KID_FRIENDLY_WORDS = [
            "Curious", "Brave", "Discover", "Imagine", "Respect", 
            "Kindness", "Explore", "Create", "Effort", "Focus",
            "Gentle", "Honest", "Listen", "Share", "Friend",
            "Idea", "Nature", "Protect", "Wonder", "Puzzle",
            "Team", "Value", "Growth", "Calm", "Bright",
            "Energy", "Learn", "Dream", "Helpful", "Smart"
        ];

        const WeatherType = {
            Sunny: '‚òÄÔ∏è',
            Cloudy: '‚òÅÔ∏è',
            PartlyCloudy: 'üå¶Ô∏è',
            Rainy: 'üåßÔ∏è',
            Windy: 'üí®',
            Snowy: '‚ùÑÔ∏è',
            Hot: 'üî•',
            Cold: 'ü•∂',
        };

        /*********************************************************
         * AUDIO & TTS LOGIC
         *********************************************************/
        
        // Global Audio Context
        let audioContext = null;
        let activeSource = null;

        function getAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }

        async function playAudioData(arrayBuffer) {
            const ctx = getAudioContext();
            
            // Stop existing audio
            if (activeSource) {
                try { activeSource.stop(); } catch(e) {}
                activeSource = null;
            }

            // Decode the MP3/WAV data
            const audioBuffer = await ctx.decodeAudioData(arrayBuffer);
            
            const source = ctx.createBufferSource();
            source.buffer = audioBuffer;
            source.connect(ctx.destination);
            source.start(0);
            activeSource = source;

            return new Promise((resolve) => {
                source.onended = () => {
                    activeSource = null;
                    resolve();
                };
            });
        }

        function stopAudio() {
             if (activeSource) {
                try { activeSource.stop(); } catch(e) {}
                activeSource = null;
            }
        }

        const TTSButton = ({ text, highContrast, className = "" }) => {
            const [status, setStatus] = React.useState('idle'); // idle, loading, playing
            
            const handleClick = async (e) => {
                e.stopPropagation();
                
                if (status === 'playing') {
                    stopAudio();
                    setStatus('idle');
                    return;
                }

                if (status === 'loading') return;

                try {
                    setStatus('loading');
                    
                    const apiKey = window.process?.env?.ELEVEN_LABS_API_KEY;
                    // "George" Voice ID (British, Warm, Male)
                    const VOICE_ID = 'JBFqnCBsd6RMkjVDRZzb'; 

                    if (!apiKey) {
                        alert("API Key missing! Please check the code config.");
                        setStatus('idle');
                        return;
                    }

                    const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}`, {
                        method: 'POST',
                        headers: {
                            'Accept': 'audio/mpeg',
                            'Content-Type': 'application/json',
                            'xi-api-key': apiKey
                        },
                        body: JSON.stringify({
                            text: text,
                            model_id: "eleven_multilingual_v2",
                            voice_settings: {
                                stability: 0.5,
                                similarity_boost: 0.75
                            }
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.detail?.message || `ElevenLabs Error: ${response.status}`);
                    }

                    const arrayBuffer = await response.arrayBuffer();
                    
                    setStatus('playing');
                    await playAudioData(arrayBuffer);
                    setStatus('idle');

                } catch (error) {
                    console.error("TTS Error:", error);
                    alert(`Error generating speech: ${error.message || error}.`);
                    setStatus('idle');
                }
            };

            // Cleanup on unmount
            React.useEffect(() => {
                return () => {
                    if (status === 'playing') stopAudio();
                };
            }, []);

            const btnClass = highContrast 
                ? "bg-yellow-400 text-black border-2 border-white hover:bg-yellow-300"
                : "bg-white text-primary shadow-md hover:shadow-lg hover:bg-gray-50";

            return (
                <button
                    onClick={handleClick}
                    className={`absolute top-4 left-4 p-3 rounded-full z-50 transition-all ${btnClass} ${className}`}
                    title="Read aloud"
                    aria-label={status === 'playing' ? "Stop reading" : "Read screen"}
                >
                    {status === 'loading' && (
                        <svg className="animate-spin h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    )}
                    {status === 'playing' && <span className="text-2xl">‚èπÔ∏è</span>}
                    {status === 'idle' && <span className="text-2xl">üîä</span>}
                </button>
            );
        };


        /*********************************************************
         * COMPONENT: LAYOUT
         *********************************************************/
        const Layout = ({ children, highContrast, toggleHighContrast, currentPage, totalPages, onNext, onPrev }) => {
            const baseClasses = "min-h-screen flex flex-col items-center justify-center p-4 transition-colors duration-300 font-sans";
            const themeClasses = highContrast 
                ? "bg-black text-white" 
                : "bg-gray-50 text-gray-900";

            const containerClasses = highContrast
                ? "w-full max-w-5xl p-8 rounded-2xl border-2 border-white shadow-none bg-black min-h-[700px] flex flex-col"
                : "w-full max-w-5xl p-8 rounded-2xl bg-white shadow-xl border border-gray-200 min-h-[700px] flex flex-col";

            const buttonClasses = highContrast
                ? "px-6 py-3 rounded-lg font-bold text-lg transition-transform active:scale-95 border-2 border-white bg-yellow-400 text-black hover:bg-yellow-300 disabled:opacity-50 disabled:cursor-not-allowed"
                : "px-6 py-3 rounded-lg font-bold text-lg transition-transform active:scale-95 bg-primary text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none disabled:translate-y-0";

            return (
                <div className={`${baseClasses} ${themeClasses}`}>
                    {/* Controls */}
                    <div className="absolute top-4 right-4 z-50 flex gap-2">
                        <button 
                            onClick={toggleHighContrast}
                            className={`p-3 rounded-full text-2xl transition-all ${highContrast ? 'border-2 border-white text-yellow-400 hover:bg-white hover:text-black' : 'bg-white text-gray-800 shadow-md hover:shadow-lg'}`}
                            title={highContrast ? "Disable High Contrast" : "Enable High Contrast"}
                        >
                            {highContrast ? 'üí°' : '‚òÄÔ∏è'}
                        </button>
                    </div>

                    {/* Main Canvas */}
                    <main className={containerClasses}>
                        <div className="flex-grow flex flex-col justify-center relative overflow-hidden">
                            {children}
                        </div>

                        {/* Navigation */}
                        <div className="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center shrink-0">
                            <button 
                                onClick={onPrev} 
                                disabled={currentPage === 0}
                                className={buttonClasses}
                            >
                                ‚Üê Back
                            </button>
                            
                            <div className="text-sm font-medium opacity-60">
                                Page {currentPage + 1} of {totalPages}
                            </div>

                            <button 
                                onClick={onNext} 
                                disabled={currentPage === totalPages - 1}
                                className={buttonClasses}
                            >
                                Next ‚Üí
                            </button>
                        </div>
                    </main>
                </div>
            );
        };

        /*********************************************************
         * COMPONENT: WORD OF THE DAY MODAL
         *********************************************************/
        const WordOfTheDay = ({ highContrast }) => {
            const [isOpen, setIsOpen] = React.useState(false);
            const [loading, setLoading] = React.useState(false);
            const [wordData, setWordData] = React.useState(null);

            const fetchWord = async () => {
                setLoading(true);
                setIsOpen(true);
                setWordData(null);
                
                // Pick a random word from the safe list
                const randomWord = KID_FRIENDLY_WORDS[Math.floor(Math.random() * KID_FRIENDLY_WORDS.length)];
                
                try {
                    const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${randomWord}`);
                    const data = await response.json();
                    
                    if (Array.isArray(data) && data.length > 0) {
                        const entry = data[0];
                        const phonetic = entry.phonetics.find(p => p.audio)?.audio || null;
                        // Try to find a meaning with a clear definition
                        const meaning = entry.meanings[0];
                        const def = meaning?.definitions[0];
                        
                        setWordData({
                            word: entry.word,
                            phoneticText: entry.phonetic,
                            audioUrl: phonetic,
                            partOfSpeech: meaning?.partOfSpeech,
                            definition: def?.definition,
                            example: def?.example
                        });
                    }
                } catch (e) {
                    console.error("Dictionary API error", e);
                } finally {
                    setLoading(false);
                }
            };

            const playWordAudio = (url) => {
                if(url) new Audio(url).play();
            };

            return (
                <>
                    <button 
                        onClick={fetchWord}
                        className={`mt-6 px-6 py-2 rounded-full font-bold text-sm tracking-wide transition-all transform hover:scale-105 flex items-center gap-2 mx-auto w-64 justify-center
                            ${highContrast ? 'bg-purple-600 border-2 border-white text-white' : 'bg-purple-100 text-purple-700 hover:bg-purple-200'}`}
                    >
                        <span>‚ú®</span> Word of the Day
                    </button>

                    {isOpen && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm" onClick={() => setIsOpen(false)}>
                            <div 
                                className={`relative w-full max-w-lg p-8 rounded-2xl shadow-2xl animate-pop-in cursor-auto
                                    ${highContrast ? 'bg-black border-2 border-white text-white' : 'bg-white text-gray-800'}`}
                                onClick={e => e.stopPropagation()}
                            >
                                <button 
                                    onClick={() => setIsOpen(false)}
                                    className="absolute top-4 right-4 text-2xl opacity-50 hover:opacity-100"
                                >
                                    √ó
                                </button>

                                {loading ? (
                                    <div className="flex flex-col items-center py-8">
                                        <div className="w-10 h-10 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                                        <p>Opening the dictionary...</p>
                                    </div>
                                ) : wordData ? (
                                    <div className="text-center">
                                        <div className="text-sm uppercase tracking-widest opacity-50 mb-2">Word of the Day</div>
                                        <h2 className="text-5xl font-bold mb-2 capitalize text-purple-600">{wordData.word}</h2>
                                        
                                        <div className="flex justify-center items-center gap-3 mb-6 opacity-70">
                                            <span className="italic">{wordData.partOfSpeech}</span>
                                            {wordData.phoneticText && <span>‚Ä¢ {wordData.phoneticText}</span>}
                                            {wordData.audioUrl && (
                                                <button 
                                                    onClick={() => playWordAudio(wordData.audioUrl)}
                                                    className="ml-2 p-2 rounded-full bg-purple-100 text-purple-700 hover:bg-purple-200 transition-colors"
                                                    title="Listen to pronunciation"
                                                >
                                                    üîä
                                                </button>
                                            )}
                                        </div>

                                        <div className={`p-6 rounded-xl mb-6 text-left ${highContrast ? 'bg-gray-900 border border-white' : 'bg-purple-50'}`}>
                                            <p className="text-xl font-medium mb-2 leading-relaxed">
                                                {wordData.definition}
                                            </p>
                                            {wordData.example && (
                                                <p className="text-lg italic opacity-70 mt-4 border-l-4 border-purple-300 pl-4">
                                                    "{wordData.example}"
                                                </p>
                                            )}
                                        </div>
                                        
                                        <p className="text-sm opacity-50">Who can use "{wordData.word}" in a sentence today?</p>
                                    </div>
                                ) : (
                                    <div className="text-center py-8">
                                        <p>Oops! Couldn't find a word right now.</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </>
            );
        };

        /*********************************************************
         * COMPONENT: BRAIN SPARK (Trivia)
         *********************************************************/
        const BrainSpark = ({ highContrast }) => {
            const [isOpen, setIsOpen] = React.useState(false);
            const [loading, setLoading] = React.useState(false);
            const [questionData, setQuestionData] = React.useState(null);
            const [shuffledAnswers, setShuffledAnswers] = React.useState([]);
            const [selectedAnswer, setSelectedAnswer] = React.useState(null);
            const [answered, setAnswered] = React.useState(false);

            // Helper to decode HTML entities from API
            const decodeHTML = (html) => {
                const txt = document.createElement('textarea');
                txt.innerHTML = html;
                return txt.value;
            };

            const fetchTrivia = async () => {
                setLoading(true);
                setIsOpen(true);
                setQuestionData(null);
                setSelectedAnswer(null);
                setAnswered(false);
                setShuffledAnswers([]);

                // Categories: 17 (Science & Nature), 27 (Animals), 22 (Geography)
                const categories = [17, 27, 22];
                const randomCat = categories[Math.floor(Math.random() * categories.length)];

                try {
                    // Open Trivia DB: Easy difficulty, Multiple Choice
                    const response = await fetch(`https://opentdb.com/api.php?amount=1&category=${randomCat}&difficulty=easy&type=multiple`);
                    const data = await response.json();

                    if (data.results && data.results.length > 0) {
                        const q = data.results[0];
                        
                        // Shuffle answers
                        const answers = [...q.incorrect_answers, q.correct_answer];
                        const shuffled = answers
                            .map(value => ({ value, sort: Math.random() }))
                            .sort((a, b) => a.sort - b.sort)
                            .map(({ value }) => value);

                        setQuestionData(q);
                        setShuffledAnswers(shuffled);
                    }
                } catch (e) {
                    console.error("Trivia API Error", e);
                } finally {
                    setLoading(false);
                }
            };

            const handleAnswerClick = (answer) => {
                if (answered) return;
                setSelectedAnswer(answer);
                setAnswered(true);
            };

            const closeModal = () => {
                setIsOpen(false);
                setQuestionData(null);
            };

            return (
                <>
                    <button 
                        onClick={fetchTrivia}
                        className={`mt-4 px-6 py-2 rounded-full font-bold text-sm tracking-wide transition-all transform hover:scale-105 flex items-center gap-2 mx-auto w-64 justify-center
                            ${highContrast ? 'bg-yellow-500 border-2 border-white text-black' : 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200'}`}
                    >
                        <span>üß†</span> Brain Spark
                    </button>

                    {isOpen && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm" onClick={closeModal}>
                            <div 
                                className={`relative w-full max-w-2xl p-8 rounded-2xl shadow-2xl animate-pop-in cursor-auto
                                    ${highContrast ? 'bg-black border-2 border-white text-white' : 'bg-white text-gray-800'}`}
                                onClick={e => e.stopPropagation()}
                            >
                                <button 
                                    onClick={closeModal}
                                    className="absolute top-4 right-4 text-2xl opacity-50 hover:opacity-100"
                                >
                                    √ó
                                </button>

                                {loading ? (
                                    <div className="flex flex-col items-center py-12">
                                        <div className="w-12 h-12 border-4 border-yellow-400 border-t-transparent rounded-full animate-spin mb-4"></div>
                                        <p>Sparking the brain...</p>
                                    </div>
                                ) : questionData ? (
                                    <div className="text-center">
                                        <div className="text-sm uppercase tracking-widest opacity-50 mb-4 text-yellow-600 font-bold">
                                            {decodeHTML(questionData.category)}
                                        </div>
                                        
                                        <h2 className="text-2xl md:text-3xl font-bold mb-8 leading-tight">
                                            {decodeHTML(questionData.question)}
                                        </h2>

                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                            {shuffledAnswers.map((ans, idx) => {
                                                const isSelected = selectedAnswer === ans;
                                                const isCorrect = ans === questionData.correct_answer;
                                                
                                                let btnClass = highContrast 
                                                    ? "bg-gray-800 border-2 border-white hover:bg-gray-700" 
                                                    : "bg-gray-100 hover:bg-gray-200 border-2 border-transparent";

                                                // Reveal colors
                                                if (answered) {
                                                    if (isCorrect) {
                                                        btnClass = highContrast ? "bg-green-600 border-green-400" : "bg-green-100 border-green-400 text-green-800";
                                                    } else if (isSelected && !isCorrect) {
                                                        btnClass = highContrast ? "bg-red-600 border-red-400" : "bg-red-100 border-red-400 text-red-800";
                                                    } else {
                                                        btnClass += " opacity-50";
                                                    }
                                                }

                                                return (
                                                    <button
                                                        key={idx}
                                                        onClick={() => handleAnswerClick(ans)}
                                                        disabled={answered}
                                                        className={`p-4 rounded-xl text-lg font-medium transition-all transform active:scale-95 ${btnClass}`}
                                                    >
                                                        {decodeHTML(ans)}
                                                        {answered && isCorrect && <span className="ml-2">‚úÖ</span>}
                                                        {answered && isSelected && !isCorrect && <span className="ml-2">‚ùå</span>}
                                                    </button>
                                                );
                                            })}
                                        </div>

                                        {answered && (
                                            <div className="animate-fade-in">
                                                <button 
                                                    onClick={fetchTrivia}
                                                    className={`px-8 py-3 rounded-full font-bold text-lg transition-transform hover:scale-105
                                                        ${highContrast ? 'bg-white text-black' : 'bg-yellow-400 text-yellow-900 shadow-lg'}`}
                                                >
                                                    Another Question?
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    <div className="text-center py-8">
                                        <p>Could not load a question. Try again later!</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </>
            );
        };

        /*********************************************************
         * COMPONENT: WELCOME
         *********************************************************/
        const Welcome = ({ highContrast }) => {
            const [currentDate, setCurrentDate] = React.useState(new Date());

            React.useEffect(() => {
                const timer = setInterval(() => setCurrentDate(new Date()), 60000);
                return () => clearInterval(timer);
            }, []);

            const dayName = WEEKDAYS[currentDate.getDay()];
            const monthName = MONTHS[currentDate.getMonth()];
            const dateNum = currentDate.getDate();
            const year = currentDate.getFullYear();

            const ttsText = `Good Morning M 5. Today is ${dayName}, the ${dateNum}th of ${monthName}, ${year}.`;

            return (
                <div className="text-center animate-fade-in w-full relative">
                    <TTSButton text={ttsText} highContrast={highContrast} />
                    <h1 className={`text-5xl md:text-7xl font-medium mb-6 ${highContrast ? 'text-yellow-400' : 'text-primary'}`}>
                        Good Morning M5
                    </h1>
                    <div className="space-y-4">
                        <h2 className="text-3xl md:text-4xl font-light">
                            Today is <span className="font-semibold">{dayName}</span>
                        </h2>
                        <h3 className="text-2xl md:text-3xl font-light opacity-90">
                            {dateNum} {monthName} {year}
                        </h3>
                    </div>
                    
                    <div className="flex flex-col items-center mt-8 gap-2">
                        <WordOfTheDay highContrast={highContrast} />
                        <BrainSpark highContrast={highContrast} />
                    </div>
                </div>
            );
        };

        /*********************************************************
         * COMPONENT: DATE REPRESENTATION (Updated with Grid Function)
         *********************************************************/
        const DateRepresentation = ({ highContrast }) => {
            // Target date is today's day (e.g., 24)
            const [dateVal, setDateVal] = React.useState(new Date().getDate());
            
            // State for interactive blocks
            // Tens: 5 strips of 10 (enough for date 31)
            const [tens, setTens] = React.useState(Array(5).fill(false));
            // Ones: 20 single units
            const [ones, setOnes] = React.useState(Array(20).fill(false));

            const toggleTen = (idx) => {
                const newTens = [...tens];
                newTens[idx] = !newTens[idx];
                setTens(newTens);
            };

            const toggleOne = (idx) => {
                const newOnes = [...ones];
                newOnes[idx] = !newOnes[idx];
                setOnes(newOnes);
            };

            const currentTotal = (tens.filter(Boolean).length * 10) + ones.filter(Boolean).length;
            const isCorrect = currentTotal === dateVal;
            
            const ttsText = `Represent the Date. Today is the ${dateVal}th. Tap the blocks to show the number ${dateVal}. The current total is ${currentTotal}.`;

            return (
                <div className={`text-center w-full animate-fade-in relative flex flex-col items-center ${highContrast ? 'hc-mode' : ''}`}>
                    <TTSButton text={ttsText} highContrast={highContrast} />
                    <h2 className={`text-3xl font-medium mb-2 ${highContrast ? 'text-yellow-400' : 'text-primary'}`}>
                        Represent the Date: <span className="font-bold text-4xl ml-2">{dateVal}</span>
                    </h2>
                    <p className="mb-6 text-lg opacity-80">Tap the blocks to make the number {dateVal}.</p>

                    <div className="flex flex-wrap justify-center items-end gap-8 mb-8 min-h-[250px]">
                        {/* Tens Area */}
                        <div className={`flex gap-4 items-end p-6 rounded-xl ${highContrast ? 'border border-blue-400' : 'bg-blue-50/50'}`}>
                             {tens.map((isActive, i) => (
                                <div 
                                    key={`ten-${i}`}
                                    onClick={() => toggleTen(i)}
                                    className={`grid-container grid-1x10 cursor-pointer ${isActive ? 'blue shadow-lg' : 'hover:bg-gray-50'}`}
                                    title="Click to toggle 10"
                                >
                                    {[...Array(10)].map((_, j) => <div key={j} className="square"></div>)}
                                </div>
                             ))}
                             <div className="text-sm font-bold opacity-50 absolute -bottom-6 left-1/2 transform -translate-x-1/2">TENS</div>
                        </div>

                        {/* Ones Area */}
                        <div className={`grid grid-cols-5 gap-3 p-6 rounded-xl content-end ${highContrast ? 'border border-green-400' : 'bg-green-50/50'}`}>
                            {ones.map((isActive, i) => (
                                <div 
                                    key={`one-${i}`}
                                    onClick={() => toggleOne(i)}
                                    className={`square cursor-pointer transition-all duration-200 ${isActive ? 'green shadow-md' : 'hover:bg-gray-50'}`}
                                    title="Click to toggle 1"
                                ></div>
                            ))}
                             <div className="text-sm font-bold opacity-50 absolute -bottom-6 left-1/2 transform -translate-x-1/2">ONES</div>
                        </div>
                    </div>
                    
                    <div className={`text-3xl font-bold px-8 py-4 rounded-full transition-all duration-300 transform ${
                        isCorrect 
                        ? 'bg-green-500 text-white animate-bounce shadow-lg scale-110' 
                        : highContrast ? 'bg-gray-800 border-2 border-white text-white' : 'bg-gray-100 text-gray-600'
                    }`}>
                        Total: {currentTotal} {isCorrect && "‚ú®"}
                    </div>
                </div>
            );
        };

        /*********************************************************
         * COMPONENT: DAY SELECTOR
         *********************************************************/
        const DaySelector = ({ highContrast }) => {
            const [selectedDay, setSelectedDay] = React.useState(null);
            const daysToDisplay = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"];

            const handleDragStart = (e, day) => {
                e.dataTransfer.setData('day', day);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                const day = e.dataTransfer.getData('day');
                if (day) setSelectedDay(day);
            };

            const allowDrop = (e) => e.preventDefault();
            const itemClass = highContrast
                ? "bg-gray-800 border-2 border-white text-white hover:bg-gray-700"
                : "bg-white border border-gray-200 text-gray-800 shadow-sm hover:shadow-md hover:translate-y-[-2px]";

            const ttsText = selectedDay 
                ? `Today is ${selectedDay}.` 
                : "What day is it? Drag the day into the box.";

            return (
                <div className="text-center w-full animate-fade-in relative">
                    <TTSButton text={ttsText} highContrast={highContrast} />
                    <h2 className={`text-3xl font-medium mb-8 ${highContrast ? 'text-yellow-400' : 'text-primary'}`}>Today is...</h2>

                    <div className="flex flex-wrap justify-center gap-4 mb-12">
                        {daysToDisplay.map(day => (
                            <div
                                key={day}
                                draggable
                                onDragStart={(e) => handleDragStart(e, day)}
                                className={`cursor-grab px-6 py-3 rounded-lg font-handwriting text-2xl transition-all ${itemClass}`}
                            >
                                {day}
                            </div>
                        ))}
                    </div>

                    <div 
                        onDrop={handleDrop}
                        onDragOver={allowDrop}
                        className={`max-w-md mx-auto h-32 rounded-xl flex items-center justify-center transition-colors ${highContrast ? 'border-4 border-dashed border-green-400 bg-gray-900' : 'border-4 border-dashed border-accentGreen/40 bg-green-50'}`}
                    >
                        {selectedDay ? (
                            <div className={`text-5xl font-handwriting animate-pop-in ${highContrast ? 'text-green-400' : 'text-accentGreen'}`}>
                                {selectedDay}
                            </div>
                        ) : (
                            <p className="opacity-50 text-xl">Drop the day here</p>
                        )}
                    </div>
                </div>
            );
        };

        /*********************************************************
         * COMPONENT: WEATHER
         *********************************************************/
        const WeatherObservation = ({ highContrast }) => {
            const [observations, setObservations] = React.useState([]);
            const weatherOptions = Object.values(WeatherType);

            const handleDragStart = (e, icon) => {
                e.dataTransfer.setData('icon', icon);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                const icon = e.dataTransfer.getData('icon');
                if (icon && observations.length < 4 && !observations.includes(icon)) {
                    setObservations(prev => [...prev, icon]);
                }
            };

            // Map icons back to text for TTS
            const iconToText = (icon) => {
                const entry = Object.entries(WeatherType).find(([k,v]) => v === icon);
                return entry ? entry[0] : "something";
            };

            const weatherString = observations.length > 0 
                ? observations.map(iconToText).join(" and ")
                : "unknown";

            const ttsText = observations.length > 0
                ? `Today the weather is ${weatherString}.`
                : "Today the weather is... Drag the weather icons to the box.";

            return (
                <div className="text-center w-full animate-fade-in relative">
                    <TTSButton text={ttsText} highContrast={highContrast} />
                    <h2 className={`text-3xl font-medium mb-6 ${highContrast ? 'text-yellow-400' : 'text-primary'}`}>Today the weather is...</h2>
                    <div className="flex flex-wrap justify-center gap-4 mb-10">
                        {weatherOptions.map(icon => (
                            <div
                                key={icon}
                                draggable
                                onDragStart={(e) => handleDragStart(e, icon)}
                                className="text-5xl cursor-grab hover:scale-125 transition-transform select-none p-2"
                            >
                                {icon}
                            </div>
                        ))}
                    </div>
                    <div 
                        onDrop={handleDrop}
                        onDragOver={(e) => e.preventDefault()}
                        className={`min-h-[160px] max-w-2xl mx-auto p-4 rounded-xl flex items-center justify-center gap-6 ${highContrast ? 'border-4 border-dashed border-blue-400 bg-gray-900' : 'border-4 border-dashed border-blue-200 bg-blue-50/50'}`}
                    >
                        {observations.length === 0 && <p className="opacity-50 text-xl">Drop up to 4 icons here</p>}
                        {observations.map((icon, index) => (
                            <div 
                                key={index} 
                                onClick={() => setObservations(prev => prev.filter((_, i) => i !== index))}
                                className="text-7xl cursor-pointer hover:scale-90 transition-transform animate-pop-in"
                            >
                                {icon}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const LiveWeather = ({ highContrast }) => {
            const [loading, setLoading] = React.useState(false);
            const [data, setData] = React.useState(null);
            const [aqData, setAqData] = React.useState(null);

            const fetchWeatherAndAQ = async () => {
                setLoading(true);
                
                // 1. Simulated Weather
                const weatherPromise = new Promise(resolve => {
                    setTimeout(() => {
                        resolve({
                            temp: 19,
                            desc: "Clear skies, light breeze",
                            icon: "‚òÄÔ∏è"
                        });
                    }, 1000);
                });

                // 2. Real OpenAQ Data for Seaford/Melbourne
                // Coords approx Seaford: -38.106, 145.136. Radius 25km.
                const aqPromise = (async () => {
                    try {
                        const res = await fetch('https://api.openaq.org/v2/latest?coordinates=-38.106,145.136&radius=25000&limit=1');
                        const jsonData = await res.json();
                        
                        if (jsonData.results && jsonData.results.length > 0) {
                            // Look for pm25
                            const measurements = jsonData.results[0].measurements;
                            const pm25 = measurements.find(m => m.parameter === 'pm25');
                            
                            if (pm25) {
                                const val = pm25.value;
                                // Simple AQI logic (PM2.5 ug/m3)
                                if (val <= 12) return { status: 'Good', color: 'green', emoji: 'üü¢', msg: "It‚Äôs a great day for outside play!" };
                                if (val <= 35) return { status: 'Moderate', color: 'yellow', emoji: 'üü°', msg: "Air is okay, but let's take it easy." };
                                return { status: 'Unhealthy', color: 'red', emoji: 'üî¥', msg: "The air is hazy. Better to play inside today." };
                            }
                        }
                        return null; 
                    } catch (e) {
                        console.error("OpenAQ Error:", e);
                        return null;
                    }
                })();

                const [wData, aData] = await Promise.all([weatherPromise, aqPromise]);
                setData(wData);
                setAqData(aData);
                setLoading(false);
            };

            React.useEffect(() => { fetchWeatherAndAQ(); }, []);

            const ttsText = data 
                ? `In Seaford, it is currently ${data.temp} degrees celsius with ${data.desc}. ${aqData ? `Air quality is ${aqData.status}. ${aqData.msg}` : ''}`
                : "Checking the live weather.";

            return (
                <div className="text-center w-full animate-fade-in relative">
                    <TTSButton text={ttsText} highContrast={highContrast} />
                    <h2 className={`text-3xl font-medium mb-8 ${highContrast ? 'text-yellow-400' : 'text-primary'}`}>Live Weather (Seaford, VIC)</h2>
                    
                    <div className="flex flex-col md:flex-row gap-6 justify-center items-stretch max-w-3xl mx-auto">
                        {/* Weather Card */}
                        <div className={`flex-1 p-8 rounded-2xl transition-all flex flex-col justify-center items-center ${highContrast ? 'bg-gray-800 border-2 border-white' : 'bg-gradient-to-br from-blue-400 to-blue-600 text-white shadow-xl'}`}>
                            {loading ? (
                                <div className="flex flex-col items-center py-6">
                                    <div className="w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin mb-4"></div>
                                    <p className="text-xl">Checking the sky...</p>
                                </div>
                            ) : data ? (
                                <div className="animate-fade-in">
                                    <div className="text-8xl mb-4 drop-shadow-md">{data.icon}</div>
                                    <div className="text-6xl font-bold mb-2">{data.temp}¬∞C</div>
                                    <div className="text-xl font-medium opacity-90">{data.desc}</div>
                                </div>
                            ) : (
                                <button onClick={fetchWeatherAndAQ} className="px-6 py-3 bg-white text-blue-600 rounded-full font-bold">Retry</button>
                            )}
                        </div>

                        {/* Air Quality Card */}
                        {!loading && aqData && (
                             <div className={`flex-1 p-8 rounded-2xl transition-all flex flex-col justify-center items-center animate-slide-up
                                ${highContrast 
                                    ? `bg-black border-2 border-${aqData.color}-400 text-white` 
                                    : `bg-${aqData.color}-50 border-2 border-${aqData.color}-200 text-${aqData.color}-900 shadow-lg`
                                }`}>
                                <div className="text-sm uppercase tracking-widest opacity-60 mb-4 font-bold">Air We Breathe</div>
                                <div className="text-6xl mb-4">{aqData.emoji}</div>
                                <div className="text-3xl font-bold mb-2">{aqData.status}</div>
                                <p className="text-lg opacity-80 leading-relaxed max-w-[200px]">
                                    "{aqData.msg}"
                                </p>
                            </div>
                        )}
                    </div>
                    
                    <div className="mt-6 text-xs opacity-40">
                        Weather data simulated ‚Ä¢ Air quality via OpenAQ
                    </div>
                </div>
            );
        };

        /*********************************************************
         * COMPONENT: SEASONS
         *********************************************************/
        const SeasonsSelector = ({ highContrast }) => {
            const [activeSeason, setActiveSeason] = React.useState(null);
            const seasons = [
                { id: 'summer', label: 'Summer', color: 'bg-yellow-500', icon: 'üèñÔ∏è' },
                { id: 'autumn', label: 'Autumn', color: 'bg-orange-500', icon: 'üçÇ' },
                { id: 'winter', label: 'Winter', color: 'bg-blue-500', icon: '‚ùÑÔ∏è' },
                { id: 'spring', label: 'Spring', color: 'bg-green-500', icon: 'üå±' },
            ];

            const ttsText = activeSeason 
                ? `It is currently ${seasons.find(s => s.id === activeSeason).label}.` 
                : "What season is it? Tap the correct season.";

            return (
                <div className="text-center w-full animate-fade-in relative">
                    <TTSButton text={ttsText} highContrast={highContrast} />
                    <h2 className={`text-3xl font-medium mb-10 ${highContrast ? 'text-yellow-400' : 'text-primary'}`}>What season is it?</h2>
                    <div className="grid grid-cols-2 gap-6 max-w-2xl mx-auto">
                        {seasons.map(season => (
                            <button
                                key={season.id}
                                onClick={() => setActiveSeason(season.id)}
                                className={`p-8 rounded-xl text-2xl font-bold transition-all transform hover:scale-105 flex flex-col items-center justify-center gap-4
                                    ${activeSeason === season.id ? 'ring-4 ring-offset-4 ring-primary scale-105' : 'opacity-80 hover:opacity-100'}
                                    ${highContrast ? 'border-2 border-white bg-gray-900 text-white' : `${season.color} text-white shadow-lg`}
                                `}
                            >
                                <span className="text-5xl">{season.icon}</span>
                                {season.label}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const WurundjeriSeasons = ({ highContrast }) => {
            const [currentSeason, setCurrentSeason] = React.useState(null);

            React.useEffect(() => {
                const month = new Date().getMonth();
                let seasonData;
                if (month === 0 || month === 1) seasonData = { name: 'Biderap', meaning: 'Dry Season', months: 'Jan - Feb' };
                else if (month === 2) seasonData = { name: 'Iuk', meaning: 'Eel Season', months: 'March' };
                else if (month >= 3 && month <= 6) seasonData = { name: 'Waring', meaning: 'Wombat Season', months: 'Apr - Jul' };
                else if (month === 7) seasonData = { name: 'Guling', meaning: 'Orchid Season', months: 'August' };
                else if (month >= 8 && month <= 9) seasonData = { name: 'Poorneet', meaning: 'Tadpole Season', months: 'Sep - Oct' };
                else seasonData = { name: 'Garrawang', meaning: 'Kangaroo Apple Season', months: 'Nov - Dec' };
                setCurrentSeason(seasonData);
            }, []);

            const cardClass = highContrast 
                ? "border-2 border-white bg-black text-white" 
                : "bg-orange-50 border-l-8 border-orange-500 text-gray-800 shadow-md";

            const ttsText = currentSeason 
                ? `The current Wurundjeri season is ${currentSeason.name}, which means ${currentSeason.meaning}. This occurs during ${currentSeason.months.replace('-', 'to')}.` 
                : "Loading Wurundjeri seasons.";

            return (
                <div className="text-center w-full animate-fade-in relative">
                    <TTSButton text={ttsText} highContrast={highContrast} />
                    <h2 className={`text-3xl font-medium mb-4 ${highContrast ? 'text-yellow-400' : 'text-primary'}`}>The Wurundjeri seasons</h2>
                    <p className="mb-10 opacity-70 max-w-2xl mx-auto">Connecting with Country means understanding the land's own rhythm.</p>
                    {currentSeason && (
                        <div className={`max-w-3xl mx-auto p-10 rounded-xl text-left transition-all animate-slide-up ${cardClass}`}>
                            <div className="text-sm uppercase tracking-widest opacity-60 mb-2">Current Season</div>
                            <h3 className="text-5xl font-bold mb-4 font-handwriting text-orange-600 dark:text-orange-400">{currentSeason.name}</h3>
                            <div className="text-2xl font-medium mb-2">{currentSeason.meaning}</div>
                            <div className="text-xl opacity-70">{currentSeason.months}</div>
                        </div>
                    )}
                </div>
            );
        };

        /*********************************************************
         * COMPONENT: SPACE SLIDE (NASA APOD)
         *********************************************************/
        const SpaceSlide = ({ highContrast }) => {
            const [data, setData] = React.useState(null);
            const [loading, setLoading] = React.useState(true);
            const [error, setError] = React.useState(null);

            React.useEffect(() => {
                const fetchApod = async () => {
                    try {
                        // Using DEMO_KEY. 
                        const response = await fetch('https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY');
                        if (!response.ok) throw new Error('Failed to contact NASA');
                        const json = await response.json();
                        setData(json);
                    } catch (err) {
                        console.error(err);
                        setError('Space control is offline right now. üöÄ');
                    } finally {
                        setLoading(false);
                    }
                };
                fetchApod();
            }, []);

            const containerClass = highContrast 
                ? "border-2 border-white bg-black text-white" 
                : "bg-indigo-950 text-white shadow-2xl";

            if (loading) {
                return (
                     <div className="text-center w-full h-full flex flex-col items-center justify-center animate-fade-in relative">
                         <TTSButton text="Contacting the telescope. Please wait." highContrast={highContrast} />
                        <h2 className={`text-3xl font-medium mb-8 ${highContrast ? 'text-yellow-400' : 'text-primary'}`}>Today in Space</h2>
                        <div className="animate-pulse flex flex-col items-center max-w-4xl mx-auto w-full">
                            <div className={`h-96 w-full rounded-xl mb-4 ${highContrast ? 'bg-gray-800' : 'bg-gray-200'}`}></div>
                            <div className={`h-4 w-48 rounded mb-2 ${highContrast ? 'bg-gray-800' : 'bg-gray-300'}`}></div>
                            <p className="opacity-60">Contacting the telescope...</p>
                        </div>
                    </div>
                );
            }

            if (error || !data) {
                return (
                     <div className="text-center w-full h-full flex flex-col items-center justify-center animate-fade-in relative">
                         <TTSButton text="Space control is offline." highContrast={highContrast} />
                        <h2 className={`text-3xl font-medium mb-8 ${highContrast ? 'text-yellow-400' : 'text-primary'}`}>Today in Space</h2>
                        <div className="p-8 rounded-xl bg-gray-100 text-gray-800 inline-block">
                            <span className="text-4xl mb-2 block">üõ∞Ô∏è</span>
                            <p>{error || "No data received."}</p>
                        </div>
                    </div>
                );
            }

            // Heuristic: Take the first 2 sentences for a kid-friendly summary
            const summary = data.explanation ? (data.explanation.split('. ').slice(0, 2).join('. ') + '.') : "Check out this amazing view from space!";
            
            const ttsText = `Today in Space. ${data.title}. ${summary}. What do you notice? What do you wonder?`;

            return (
                <div className="text-center w-full h-full flex flex-col items-center justify-center animate-fade-in relative">
                    <TTSButton text={ttsText} highContrast={highContrast} />
                    <h2 className={`text-3xl font-medium mb-6 ${highContrast ? 'text-yellow-400' : 'text-primary'}`}>Today in Space</h2>
                    
                    <div className={`w-full max-w-6xl rounded-2xl overflow-hidden flex flex-col md:flex-row ${containerClass}`}>
                        {/* Media Section */}
                        <div className="md:w-2/3 bg-black flex items-center justify-center min-h-[400px]">
                            {data.media_type === 'video' ? (
                                <iframe 
                                    src={data.url} 
                                    title={data.title}
                                    className="w-full h-full aspect-video border-0"
                                    allowFullScreen
                                />
                            ) : (
                                <img 
                                    src={data.url} 
                                    alt={data.title} 
                                    className="w-full h-full object-contain max-h-[600px]"
                                />
                            )}
                        </div>

                        {/* Info Section */}
                        <div className="md:w-1/3 p-8 text-left flex flex-col justify-center bg-opacity-90 relative">
                            <div className="mb-auto">
                                <div className="text-xs uppercase tracking-widest text-yellow-400 mb-2">NASA Astronomy Picture of the Day</div>
                                <h3 className="text-2xl font-bold mb-4 leading-tight text-white">{data.title}</h3>
                                
                                <div className="bg-white/5 rounded-lg p-4 mb-6 backdrop-blur-sm">
                                    <p className="text-lg text-gray-100 leading-relaxed font-light">
                                        {summary}
                                    </p>
                                </div>
                            </div>
                            
                            {/* The "Window" Prompt */}
                            <div className={`p-6 rounded-xl mt-4 transform transition-transform hover:scale-[1.02] ${highContrast ? 'bg-gray-800 border-2 border-white' : 'bg-gradient-to-br from-purple-900/50 to-blue-900/50 border border-white/20 shadow-inner'}`}>
                                <h4 className="font-bold text-yellow-300 mb-2 uppercase text-xs tracking-wider">Today's Wonder Question</h4>
                                <p className="text-2xl font-handwriting text-white italic">
                                    "What do you notice? <br/>What do you wonder?"
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        /*********************************************************
         * COMPONENT: ZONES OF REGULATION
         *********************************************************/
        const ZonesOfRegulation = ({ highContrast }) => {
            const [selectedZone, setSelectedZone] = React.useState(null);
            const zones = [
                { id: 'blue', label: 'Blue Zone', desc: 'Tired, Sad, Sick, Bored', bg: 'bg-blue-500', hcBorder: 'border-blue-400' },
                { id: 'green', label: 'Green Zone', desc: 'Happy, Focused, Calm', bg: 'bg-green-500', hcBorder: 'border-green-400' },
                { id: 'yellow', label: 'Yellow Zone', desc: 'Frustrated, Worried, Silly', bg: 'bg-yellow-400', hcBorder: 'border-yellow-400' },
                { id: 'red', label: 'Red Zone', desc: 'Mad, Angry, Terrified', bg: 'bg-red-500', hcBorder: 'border-red-500' },
            ];

            const ttsText = selectedZone 
                ? `I am in the ${zones.find(z => z.id === selectedZone).label}.` 
                : "How are you feeling today? Tap the zone that matches your feelings.";

            return (
                <div className="text-center w-full animate-fade-in relative">
                    <TTSButton text={ttsText} highContrast={highContrast} />
                    <h2 className={`text-3xl font-medium mb-4 ${highContrast ? 'text-yellow-400' : 'text-primary'}`}>How are you feeling?</h2>
                    <p className="mb-8 text-xl opacity-80">Choose your zone. It's okay to be in any zone.</p>
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4 w-full">
                        {zones.map((zone) => {
                            const isSelected = selectedZone === zone.id;
                            return (
                                <button
                                    key={zone.id}
                                    onClick={() => setSelectedZone(zone.id)}
                                    className={`
                                        p-6 rounded-xl flex flex-col items-center justify-between h-64 transition-all duration-300
                                        ${isSelected ? 'scale-105 shadow-2xl ring-4 ring-offset-2 ring-gray-400 z-10' : 'hover:scale-105 hover:shadow-xl opacity-90 hover:opacity-100'}
                                        ${highContrast 
                                            ? `bg-black border-4 text-white ${zone.hcBorder}` 
                                            : `${zone.bg} text-white`
                                        }
                                    `}
                                >
                                    <span className="text-2xl font-bold">{zone.label}</span>
                                    <div className="mt-4 text-sm font-medium opacity-90 leading-relaxed">
                                        {zone.desc}
                                    </div>
                                    {isSelected && <span className="text-3xl mt-4">‚úì</span>}
                                </button>
                            );
                        })}
                    </div>
                </div>
            );
        };

        /*********************************************************
         * COMPONENT: CLASS MANAGEMENT (Monitor & Timetable)
         *********************************************************/
        const MonitorSelector = ({ highContrast }) => {
            const [monitor, setMonitor] = React.useState('?');
            const [isChoosing, setIsChoosing] = React.useState(false);

            const chooseMonitor = () => {
                setIsChoosing(true);
                let count = 0;
                const interval = setInterval(() => {
                    setMonitor(CLASS_LIST[Math.floor(Math.random() * CLASS_LIST.length)]);
                    count++;
                    if (count > 20) {
                        clearInterval(interval);
                        setIsChoosing(false);
                    }
                }, 100);
            };

            const ttsText = monitor !== '?' 
                ? `Today's monitor is ${monitor}.` 
                : "Who is today's monitor? Press the button to choose.";

            return (
                <div className="text-center w-full animate-fade-in relative">
                    <TTSButton text={ttsText} highContrast={highContrast} />
                    <h2 className={`text-3xl font-medium mb-12 ${highContrast ? 'text-yellow-400' : 'text-primary'}`}>Today's Monitor is...</h2>
                    <div className={`text-6xl md:text-8xl font-handwriting mb-12 h-32 flex items-center justify-center ${isChoosing ? 'opacity-70 blur-sm' : 'animate-pop-in'}`}>
                        {monitor}
                    </div>
                    <button
                        onClick={chooseMonitor}
                        disabled={isChoosing}
                        className={`px-8 py-4 text-xl rounded-full font-bold transition-all ${highContrast 
                            ? 'bg-yellow-400 text-black border-2 border-white hover:bg-yellow-300' 
                            : 'bg-primary text-white shadow-lg hover:scale-105 active:scale-95'}`}
                    >
                        {isChoosing ? 'Choosing...' : 'Choose Monitor ‚ú®'}
                    </button>
                </div>
            );
        };

        const DailyTimetable = ({ highContrast }) => {
            const [schedule, setSchedule] = React.useState([]);

            React.useEffect(() => {
                const day = new Date().getDay();
                const todaySchedule = TIMETABLES[day] || TIMETABLES[1];
                setSchedule(todaySchedule);
            }, []);

            const itemClass = highContrast
                ? "bg-gray-900 border-b border-gray-700 text-white"
                : "bg-white border-b border-gray-100 hover:bg-gray-50 text-gray-800";

            const scheduleText = schedule.map(item => `${item.time}, ${item.activity}`).join(". ");
            const ttsText = `Today's Plan. ${scheduleText}`;

            return (
                <div className="w-full max-w-2xl mx-auto animate-fade-in relative">
                    <TTSButton text={ttsText} highContrast={highContrast} className="!-left-12 !top-0" />
                    <h2 className={`text-3xl font-medium mb-8 text-center ${highContrast ? 'text-yellow-400' : 'text-primary'}`}>Today's Plan</h2>
                    <div className={`rounded-2xl overflow-hidden ${highContrast ? 'border-2 border-white' : 'shadow-xl bg-white'}`}>
                        {schedule.map((item, index) => (
                            <div 
                                key={index}
                                className={`flex items-center p-5 transition-colors ${itemClass} ${index === schedule.length - 1 ? 'border-b-0' : ''}`}
                            >
                                <div className="w-20 font-bold opacity-60 text-sm md:text-base">{item.time}</div>
                                <div className="text-3xl mr-6 select-none">{item.icon}</div>
                                <div className="text-xl font-medium flex-1">{item.activity}</div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        /*********************************************************
         * MAIN APP COMPONENT
         *********************************************************/
        const App = () => {
            const [highContrast, setHighContrast] = React.useState(false);
            const [currentSlide, setCurrentSlide] = React.useState(0);

            const slides = [
                <Welcome highContrast={highContrast} />,
                <DateRepresentation highContrast={highContrast} />,
                <DaySelector highContrast={highContrast} />,
                <WeatherObservation highContrast={highContrast} />,
                <LiveWeather highContrast={highContrast} />,
                <SeasonsSelector highContrast={highContrast} />,
                <WurundjeriSeasons highContrast={highContrast} />,
                <SpaceSlide highContrast={highContrast} />,
                <ZonesOfRegulation highContrast={highContrast} />,
                <MonitorSelector highContrast={highContrast} />,
                <DailyTimetable highContrast={highContrast} />,
            ];

            const handleNext = () => {
                if (currentSlide < slides.length - 1) setCurrentSlide(prev => prev + 1);
            };

            const handlePrev = () => {
                if (currentSlide > 0) setCurrentSlide(prev => prev - 1);
            };

            return (
                <Layout
                    highContrast={highContrast}
                    toggleHighContrast={() => setHighContrast(!highContrast)}
                    currentPage={currentSlide}
                    totalPages={slides.length}
                    onNext={handleNext}
                    onPrev={handlePrev}
                >
                    <div className="w-full h-full flex items-center justify-center">
                        {slides[currentSlide]}
                    </div>
                </Layout>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>